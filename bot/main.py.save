import os
import threading
from flask import Flask
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes

# ====== ENV ======
BOT_TOKEN = os.environ.get("BOT_TOKEN")

# ====== FLASK KEEP-ALIVE SERVER ======
app_flask = Flask(__name__)

@app_flask.route("/")
def home():
    return "Bot is running"

def run_flask():
    app_flask.run(host="0.0.0.0", port=int(os.environ.get("PORT", 10000)))

# ====== TELEGRAM BOT ======
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [
        [InlineKeyboardButton("ğŸ†“ Free Signals", callback_data="free")],
        [InlineKeyboardButton("ğŸ’ VIP Signals", callback_data="vip")],
        [InlineKeyboardButton("ğŸ® Games", callback_data="games")],
        [InlineKeyboardButton("ğŸ’³ Subscribe", callback_data="subscribe")],
        [InlineKeyboardButton("â„¹ï¸ About Bot", callback_data="about")]
    ]

    await update.message.reply_text(
        "ğŸ‘‹ Welcome to *Primpex Drops Bot*\n\nChoose an option ğŸ‘‡",
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    await query.edit_message_text(f"You clicked: {query.data}")

def main():
    print("ğŸ¤– Bot starting...")

    threading.Thread(target=run_flask).start()

    application = Application.builder().token(BOT_TOKEN).build()
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(button_handler))

    application.run_polling(drop_pending_updates=True)

if __name__ == "__main__":
    main()
